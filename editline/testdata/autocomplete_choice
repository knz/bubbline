run
reset
resize 40 10
set_autocomplete_2
----
TEA WINDOW SIZE: {40 10}
-- view:
[40m[37m> [0m[0m[40m[0m[40m[7m [0m[0m[40m[0m[40m                                   [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá

# No context brings up full completion menu.
run
key tab
----
TEA PRINT: {We're matching ""!}
-- view:
[93;104mnames[0m        ‚ê§
 [95mAlice       [0m‚ê§
 Amanda      ‚ê§
             ‚ê§
  [90m1/50[0m       ‚ê§
[90m(entry "Alice" has no description)[0m‚ê§
[40m[37m> [0m[0m[40m[0m[40m[7m [0m[0m[40m[0m[40m                                   [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclose/cancel[0m[90m ‚Ä¢ [0m[90m‚Üí/M-n[0m [90mnext column[0m[90m ‚Ä¢ [0m[90mC-j/enter/tab[0m [90maccept[0m[90m ‚Ä¢ [0m[90mC-p/‚Üë[0m [90mprev entry[0m[90m ‚Ä¢ [0m[90mC-n/‚Üì[0m [90mnext entry[0m[90m ‚Ä¢ [0m[90m/[0m [90mfilter[0m[90m ‚Ä¢ [0m[90mM-?[0m [90mtoggle key help[0müõá

# If we press "/" during the menu, a filter comes up.
run
key /
----
-- view:
[93mFilter: [0m[7;95m [0m    ‚ê§
 [95mAlice       [0m‚ê§
 Amanda      ‚ê§
             ‚ê§
  [90m1/50[0m       ‚ê§
[90m(entry "Alice" has no description)[0m‚ê§
[40m[37m> [0m[0m[40m[0m[40m[7m [0m[0m[40m[0m[40m                                   [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclose/cancel[0m[90m ‚Ä¢ [0m[90mC-j/enter[0m [90maccept filter[0m[90m ‚Ä¢ [0m[90mC-g[0m [90mclear/cancel[0müõá

# Entering text at the filter filters down the list.
run
type thur
----
-- view:
[93mFilter: [0mhur[7;95m [0m ‚ê§
 [95mArthur      [0m‚ê§
             ‚ê§
             ‚ê§
  [90m‚Ä¢[0m[90m‚Ä¢[0m[90m‚Ä¢[0m[90m‚Ä¢[0m[90m‚Ä¢[0m[90m‚Ä¢[0m[90m‚Ä¢[0m[90m‚Ä¢[0m   ‚ê§
[90m(entry "Arthur" has no description)[0m‚ê§
[40m[37m> [0m[0m[40m[0m[40m[7m [0m[0m[40m[0m[40m                                   [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclose/cancel[0m[90m ‚Ä¢ [0m[90mC-j/enter[0m [90maccept filter[0m[90m ‚Ä¢ [0m[90mC-g[0m [90mclear/cancel[0müõá

# Pressing enter makes the filter disappear and
# keeps the selection.
run
enter
----
-- view:
[93;104mnames[0m        ‚ê§
 [95mArthur      [0m‚ê§
             ‚ê§
             ‚ê§
             ‚ê§
[90m(entry "Arthur" has no description)[0m‚ê§
[40m[37m> [0m[0m[40m[0m[40m[7m [0m[0m[40m[0m[40m                                   [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclose/cancel[0m[90m ‚Ä¢ [0m[90m‚Üí/M-n[0m [90mnext column[0m[90m ‚Ä¢ [0m[90mC-j/enter/tab[0m [90maccept[0m[90m ‚Ä¢ [0m[90mC-p/‚Üë[0m [90mprev entry[0m[90m ‚Ä¢ [0m[90mC-n/‚Üì[0m [90mnext entry[0m[90m ‚Ä¢ [0m[90m/[0m [90mfilter[0m[90m ‚Ä¢ [0m[90mC-g[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mC-j/enter[0m [90maccept filter[0m[90m ‚Ä¢ [0m[90mM-?[0m [90mtoggle key help[0müõá

# If we press enter during the menu, this selects
# the current entry.
run
key enter
----
-- view:
[40m[37m> [0m[0m[40mArthur [0m[40m[7m [0m[0m[40m[0m[40m                            [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá

# Verify that if no entry is selected, nothing bad happens
# (regression test for an earlier display bug)
run
key tab
key /
type invalid
----
TEA PRINT: {We're matching ""!}
-- view:
[93mFilter: [0mlid[7;95m [0m‚ê§
            ‚ê§
            ‚ê§
            ‚ê§
            ‚ê§
[90m(no entry seleted)[0m‚ê§
[40m[37m> [0m[0m[40mArthur [0m[40m[7m [0m[0m[40m[0m[40m                            [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclose/cancel[0m[90m ‚Ä¢ [0m[90mC-j/enter[0m [90maccept filter[0m[90m ‚Ä¢ [0m[90mC-g[0m [90mclear/cancel[0müõá

# With a prefix, the completion list is pre-filtered.
run
reset
type b
key tab
----
TEA PRINT: {We're matching "B"!}
-- view:
[93;104mnames[0m    ‚ê§
 [95mBarbara [0m‚ê§
 Betty   ‚ê§
 Brenda  ‚ê§
 Brian   ‚ê§
         ‚ê§
         ‚ê§
[90m(entry "Barbara" has no description)[0m‚ê§
[40m[37m> [0m[0m[40mB[0m[40m[7m [0m[0m[40m[0m[40m                                   [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclose/cancel[0m[90m ‚Ä¢ [0m[90m‚Üí/M-n[0m [90mnext column[0m[90m ‚Ä¢ [0m[90mC-j/enter/tab[0m [90maccept[0m[90m ‚Ä¢ [0m[90mC-p/‚Üë[0m [90mprev entry[0m[90m ‚Ä¢ [0m[90mC-n/‚Üì[0m [90mnext entry[0m[90m ‚Ä¢ [0m[90m/[0m [90mfilter[0m[90m ‚Ä¢ [0m[90mM-?[0m [90mtoggle key help[0müõá

# We can hide/show more key help.
run
key alt+?
----
-- view:
[93;104mnames[0m    ‚ê§
 [95mBarbara [0m‚ê§
 Betty   ‚ê§
 Brenda  ‚ê§
 Brian   ‚ê§
         ‚ê§
         ‚ê§
[90m(entry "Barbara" has no description)[0m‚ê§
[40m[37m> [0m[0m[40mB[0m[40m[7m [0m[0m[40m[0m[40m                                   [0m‚ê§
[90m‚Üí/M-n[0m         [90mnext column[0m  [90m‚Ä¶[0m‚ê§
[90m‚Üê/M-p[0m         [90mprev column[0m   ‚ê§
[90mC-j/enter/tab[0m [90maccept[0m        ‚ê§
[90mC-c[0m           [90mclose/cancel[0m  üõá


run
key alt+?
----
-- view:
[93;104mnames[0m    ‚ê§
 [95mBarbara [0m‚ê§
 Betty   ‚ê§
 Brenda  ‚ê§
 Brian   ‚ê§
         ‚ê§
         ‚ê§
[90m(entry "Barbara" has no description)[0m‚ê§
[40m[37m> [0m[0m[40mB[0m[40m[7m [0m[0m[40m[0m[40m                                   [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclose/cancel[0m[90m ‚Ä¢ [0m[90m‚Üí/M-n[0m [90mnext column[0m[90m ‚Ä¢ [0m[90mC-j/enter/tab[0m [90maccept[0m[90m ‚Ä¢ [0m[90mC-p/‚Üë[0m [90mprev entry[0m[90m ‚Ä¢ [0m[90mC-n/‚Üì[0m [90mnext entry[0m[90m ‚Ä¢ [0m[90m/[0m [90mfilter[0m[90m ‚Ä¢ [0m[90mM-?[0m [90mtoggle key help[0müõá

# Completion is canceled without input upon ctrl+c.
run
key ctrl+c
----
-- view:
[40m[37m> [0m[0m[40mB[0m[40m[7m [0m[0m[40m[0m[40m                                   [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá

# If the pre-filtered list of completions contains a prefix longer
# than the current input, that prefix is pre-entered even as the
# completion list is displayed.
run
reset
type chr
key tab
----
TEA PRINT: {We're matching "Chr"!}
-- view:
[93;104mnames[0m        ‚ê§
 [95mChristine   [0m‚ê§
 Christopher ‚ê§
             ‚ê§
             ‚ê§
[90m(entry "Christine" has no description)[0m‚ê§
[40m[37m> [0m[0m[40mChrist[0m[40m[7m [0m[0m[40m[0m[40m                              [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclose/cancel[0m[90m ‚Ä¢ [0m[90m‚Üí/M-n[0m [90mnext column[0m[90m ‚Ä¢ [0m[90mC-j/enter/tab[0m [90maccept[0m[90m ‚Ä¢ [0m[90mC-p/‚Üë[0m [90mprev entry[0m[90m ‚Ä¢ [0m[90mC-n/‚Üì[0m [90mnext entry[0m[90m ‚Ä¢ [0m[90m/[0m [90mfilter[0m[90m ‚Ä¢ [0m[90mC-j/enter[0m [90maccept filter[0m[90m ‚Ä¢ [0m[90mM-?[0m [90mtoggle key help[0müõá

# After a completion is selected, it appends to the pre-filled prefix.
run
key down
key enter
----
-- view:
[40m[37m> [0m[0m[40mChristopher [0m[40m[7m [0m[0m[40m[0m[40m                        [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá

# That prefilled common prefix is also preserved when ctrl+c is
# pressed.
run
reset
type chr
key tab
key ctrl+c
----
TEA PRINT: {We're matching "Chr"!}
-- view:
[40m[37m> [0m[0m[40mChrist[0m[40m[7m [0m[0m[40m[0m[40m                              [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá
