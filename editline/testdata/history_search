run observe=(view,history)
reset
resize 40 25
set_history
type baseline text
----
TEA WINDOW SIZE: {40 25}
-- view:
[40m[37m> [0m[0m[40mbaseline text[0m[40m[7m [0m[0m[40m[0m[40m                      [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mC-r[0m [90msearch hist[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá
-- history:
say hello to the world
peter parker was not spiderman
this is a big world indeed

# The "search backward" shortcut starts history search.
run
key ctrl+r
----
-- view:
[40m[37m> [0m[0m[40mbaseline text[0m[40m[7m [0m[0m[40m[0m[40m                      [0m‚ê§
bck:[7me[0m[90mnter search term, or C-g to cancel sea[0m[90m[0müõá

# Once we start typing text, we get to the first entry that matches.
run
type w
----
-- view:
[40m[37m> [0m[0m[40mthis is a big [0m[40m[7mw[0m[0m[40morld indeed [0m[40m         [0m‚ê§
bck:w[7m [0m                                     üõá

run
type a
----
-- view:
[40m[37m> [0m[0m[40mpeter parker [0m[40m[7mw[0m[0m[40mas not spiderman [0m[40m     [0m‚ê§
bck:wa[7m [0m                                    üõá

run
key ctrl+h
----
-- view:
[40m[37m> [0m[0m[40mthis is a big [0m[40m[7mw[0m[0m[40morld indeed [0m[40m         [0m‚ê§
bck:w[7m [0m                                     üõá

run
type orld
----
-- view:
[40m[37m> [0m[0m[40mthis is a big [0m[40m[7mw[0m[0m[40morld indeed [0m[40m         [0m‚ê§
bck:world[7m [0m                                 üõá

# Ctrl+r searches further.
run
key ctrl+r
----
-- view:
[40m[37m> [0m[0m[40msay hello to the [0m[40m[7mw[0m[0m[40morld [0m[40m             [0m‚ê§
bck:world[7m [0m                                 üõá

# If there is no more match, the search prompt
# switches to a question mark.
run
key ctrl+r
----
-- view:
[40m[37m> [0m[0m[40msay hello to the [0m[40m[7mw[0m[0m[40morld [0m[40m             [0m‚ê§
bck?world[7m [0m                                 üõá

# Ctrl+G cancels the search and restores the original
# value.
run
key ctrl+g
----
-- view:
[40m[37m> [0m[0m[40mbaseline text[0m[40m[7m [0m[0m[40m[0m[40m                      [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mC-r[0m [90msearch hist[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá

# If we search for a non-existent pattern, the prompt also
# turns into a question mark.
run
key ctrl+r
type woooo
----
-- view:
[40m[37m> [0m[0m[40mthis is a big [0m[40m[7mw[0m[0m[40morld indeed [0m[40m         [0m‚ê§
bck?woooo[7m [0m                                 üõá

# Search can also use a pattern.
run
key ctrl+g
key ctrl+r
type w?rld
----
-- view:
[40m[37m> [0m[0m[40mthis is a big [0m[40m[7mw[0m[0m[40morld indeed [0m[40m         [0m‚ê§
bck:w?rld[7m [0m                                 üõá

# If the pattern is invalid, we get another search prompt.
run
key ctrl+g
key ctrl+r
type wo[
----
-- view:
[40m[37m> [0m[0m[40mthis is a big [0m[40m[7mw[0m[0m[40morld indeed [0m[40m         [0m‚ê§
bck!wo[[7m [0m                                   üõá

# The prompt switches back to normal once the pattern is valid.
run
type r]ld
----
-- view:
[40m[37m> [0m[0m[40mthis is a big [0m[40m[7mw[0m[0m[40morld indeed [0m[40m         [0m‚ê§
bck:wo[r]ld[7m [0m                               üõá

# Ctrl+D during search with a non-empty pattern will be a regular
# keystroke and accepts the input.
run
key ctrl+d
----
-- view:
[40m[37m> [0m[0m[40mthis is a big [0m[40m[7mw[0m[0m[40morld indeed [0m[40m         [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mC-r[0m [90msearch hist[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá

# Ctrl+d at the start of the search simply cancels the search.
run
key ctrl+r
key ctrl+d
----
-- view:
[40m[37m> [0m[0m[40mthis is a big [0m[40m[7mw[0m[0m[40morld indeed [0m[40m         [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mC-r[0m [90msearch hist[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá

# Enter after finding an entry accepts the entry, but does not
# let the enter key go through (we do not add a newline)
run
key ctrl+r
type parker
key enter
----
-- view:
[40m[37m> [0m[0m[40mpeter [0m[40m[7mp[0m[0m[40marker was not spiderman [0m[40m     [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mC-r[0m [90msearch hist[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá

# We can also force-accept the entry udring a search.
run
key ctrl+r
type world
key alt+enter
noop
----
TEA QUIT
-- view:
[37m[37m> [0m[0m[37mthis is a big [0m[37m[37mw[0m[0m[37morld indeed [0m[37m         [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mC-r[0m [90msearch hist[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá

# If we start navigating after starting a search,
# the navigation goes through in the regular editor.
# See: https://github.com/cockroachdb/cockroach/issues/21826
run
key ctrl+r
type parker
key left
----
-- view:
[40m[37m> [0m[0m[40mpeter[0m[40m[7m [0m[0m[40mparker was not spiderman [0m[40m     [0m‚ê§
[90mM-?[0m [90mtoggle key help[0m[90m ‚Ä¢ [0m[90mC-d[0m [90merase/stop[0m[90m ‚Ä¢ [0m[90mC-c[0m [90mclear/cancel[0m[90m ‚Ä¢ [0m[90mC-r[0m [90msearch hist[0m[90m ‚Ä¢ [0m[90mM-.[0m [90mhide/show prompt[0müõá
