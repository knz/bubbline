# When we insert a very long line, it wraps around.
run
focus
enter lorem ipsum dolor sit amet, consectetur adipiscing elit,
enter sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[37m‚îÉ [0m[37m 2 [0msed do eiusmod tempor incididunt   ‚ê§
[37m‚îÉ [0m[37m   [0mut labore et dolore magna aliqua.  ‚ê§
[40m[37m‚îÉ [0m[0m[40m 3 [0m[40m[0m[40m[7m [0m[0m[40m[0m[40m                                  [0m‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá

# When we move the cursor around, it navigates around the wrapped text.
run observe=(view,pos)
key up
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[40m[37m‚îÉ [0m[0m[40m 2 [0m[40msed do eiusmod tempor incididunt [0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40m[0m[40m[7mu[0m[0m[40mt labore et dolore magna aliqua. [0m[40m [0m‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 1, Pos 33, (row 1, col 33, lastCharOffset 0)
LineInfo: {Width:34 CharWidth:33 Height:2 StartColumn:33 ColumnOffset:0 RowOffset:1 CharOffset:0}
AtBeginningOfEmptyLine: false, AtFirstLineOfInputAndView: false, AtLastLineOfInputAndView: false

run observe=(view,pos)
key left
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[40m[37m‚îÉ [0m[0m[40m 2 [0m[40msed do eiusmod tempor incididunt[0m[40m[7m [0m[0m[40m[0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40mut labore et dolore magna aliqua. [0m[40m [0m‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 1, Pos 32, (row 1, col 32, lastCharOffset 0)
LineInfo: {Width:33 CharWidth:33 Height:2 StartColumn:0 ColumnOffset:32 RowOffset:0 CharOffset:32}
AtBeginningOfEmptyLine: false, AtFirstLineOfInputAndView: false, AtLastLineOfInputAndView: false

run
key left
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[40m[37m‚îÉ [0m[0m[40m 2 [0m[40msed do eiusmod tempor incididun[0m[40m[7mt[0m[0m[40m [0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40mut labore et dolore magna aliqua. [0m[40m [0m‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá

# When we move to "beginning of line" or "end of line", it's the
# entire wrapped line.
run
key ctrl+e
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[40m[37m‚îÉ [0m[0m[40m 2 [0m[40msed do eiusmod tempor incididunt [0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40mut labore et dolore magna aliqua.[0m[40m[7m [0m[0m[40m[0m[40m [0m‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá

run
key ctrl+a
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[40m[37m‚îÉ [0m[0m[40m 2 [0m[40m[0m[40m[7ms[0m[0m[40med do eiusmod tempor incididunt [0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40mut labore et dolore magna aliqua. [0m[40m [0m‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá

# When we move to a previous long line, we get into the middle of it.
run
key right
key up
----
-- view:
[40m[37m‚îÉ [0m[0m[40m 1 [0m[40mlorem ipsum dolor sit amet, [0m[40m       [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40mc[0m[40m[7mo[0m[0m[40mnsectetur adipiscing elit, [0m[40m      [0m‚ê§
[37m‚îÉ [0m[37m 2 [0msed do eiusmod tempor incididunt   ‚ê§
[37m‚îÉ [0m[37m   [0mut labore et dolore magna aliqua.  ‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá

# Then back down.
run
key down
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[40m[37m‚îÉ [0m[0m[40m 2 [0m[40ms[0m[40m[7me[0m[0m[40md do eiusmod tempor incididunt [0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40mut labore et dolore magna aliqua. [0m[40m [0m‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá

# If we are far right, and we move up, the original column of the
# cursor is preserved.
run observe=(view,pos)
key ctrl+e
key up
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[40m[37m‚îÉ [0m[0m[40m 2 [0m[40msed do eiusmod tempor incididunt[0m[40m[7m [0m[0m[40m[0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40mut labore et dolore magna aliqua. [0m[40m [0m‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 1, Pos 32, (row 1, col 32, lastCharOffset 33)
LineInfo: {Width:33 CharWidth:33 Height:2 StartColumn:0 ColumnOffset:32 RowOffset:0 CharOffset:32}
AtBeginningOfEmptyLine: false, AtFirstLineOfInputAndView: false, AtLastLineOfInputAndView: false

run observe=(view,pos)
key up
----
-- view:
[40m[37m‚îÉ [0m[0m[40m 1 [0m[40mlorem ipsum dolor sit amet, [0m[40m       [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40mconsectetur adipiscing elit,[0m[40m[7m [0m[0m[40m[0m[40m      [0m‚ê§
[37m‚îÉ [0m[37m 2 [0msed do eiusmod tempor incididunt   ‚ê§
[37m‚îÉ [0m[37m   [0mut labore et dolore magna aliqua.  ‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 0, Pos 56, (row 0, col 56, lastCharOffset 33)
LineInfo: {Width:29 CharWidth:29 Height:2 StartColumn:28 ColumnOffset:28 RowOffset:1 CharOffset:28}
AtBeginningOfEmptyLine: false, AtFirstLineOfInputAndView: false, AtLastLineOfInputAndView: false

# So we get back to position on the way down.
run observe=(view,pos)
key down
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[40m[37m‚îÉ [0m[0m[40m 2 [0m[40msed do eiusmod tempor incididunt[0m[40m[7m [0m[0m[40m[0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40mut labore et dolore magna aliqua. [0m[40m [0m‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 1, Pos 32, (row 1, col 32, lastCharOffset 33)
LineInfo: {Width:33 CharWidth:33 Height:2 StartColumn:0 ColumnOffset:32 RowOffset:0 CharOffset:32}
AtBeginningOfEmptyLine: false, AtFirstLineOfInputAndView: false, AtLastLineOfInputAndView: false

run observe=(view,pos)
key down
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[40m[37m‚îÉ [0m[0m[40m 2 [0m[40msed do eiusmod tempor incididunt [0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40mut labore et dolore magna aliqua.[0m[40m[7m [0m[0m[40m[0m[40m [0m‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 1, Pos 66, (row 1, col 66, lastCharOffset 33)
LineInfo: {Width:34 CharWidth:34 Height:2 StartColumn:33 ColumnOffset:33 RowOffset:1 CharOffset:33}
AtBeginningOfEmptyLine: false, AtFirstLineOfInputAndView: false, AtLastLineOfInputAndView: false

# When moving down from a long line into an empty line, cursor
# moves to the beginning.
run observe=(view,pos)
key down
----
-- view:
[37m‚îÉ [0m[37m 1 [0mlorem ipsum dolor sit amet,        ‚ê§
[37m‚îÉ [0m[37m   [0mconsectetur adipiscing elit,       ‚ê§
[37m‚îÉ [0m[37m 2 [0msed do eiusmod tempor incididunt   ‚ê§
[37m‚îÉ [0m[37m   [0mut labore et dolore magna aliqua.  ‚ê§
[40m[37m‚îÉ [0m[0m[40m 3 [0m[40m[0m[40m[7m [0m[0m[40m[0m[40m                                  [0m‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 2, Pos 0, (row 2, col 0, lastCharOffset 33)
LineInfo: {Width:1 CharWidth:1 Height:1 StartColumn:0 ColumnOffset:0 RowOffset:0 CharOffset:0}
AtBeginningOfEmptyLine: true, AtFirstLineOfInputAndView: false, AtLastLineOfInputAndView: true

# When moving up from a long line into an empty line, cursor
# also moves to the beginning.
run observe=(view,pos)
key alt+<
# Erase first line
key ctrl+k
# go to long line
key down
key ctrl+e
# move up
key up
key up
----
-- view:
[40m[37m‚îÉ [0m[0m[40m 1 [0m[40m[0m[40m[7m [0m[0m[40m[0m[40m                                  [0m‚ê§
[37m‚îÉ [0m[37m 2 [0msed do eiusmod tempor incididunt   ‚ê§
[37m‚îÉ [0m[37m   [0mut labore et dolore magna aliqua.  ‚ê§
[37m‚îÉ [0m[37m 3 [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 0, Pos 0, (row 0, col 0, lastCharOffset 33)
LineInfo: {Width:1 CharWidth:1 Height:1 StartColumn:0 ColumnOffset:0 RowOffset:0 CharOffset:0}
AtBeginningOfEmptyLine: true, AtFirstLineOfInputAndView: true, AtLastLineOfInputAndView: false


# Special long line behavior with wide runes.
# The last position on the first line is skipped because
# we're not sure if the wide run would fit.
run observe=(view,pos,value)
setvalue ""
type ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è©
----
-- view:
[40m[37m‚îÉ [0m[0m[40m 1 [0m[40m‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© [0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40m‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è©[0m[40m[7m [0m[0m[40m[0m[40m           [0m‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 0, Pos 37, (row 0, col 37, lastCharOffset 0)
LineInfo: {Width:16 CharWidth:24 Height:2 StartColumn:22 ColumnOffset:15 RowOffset:1 CharOffset:23}
AtBeginningOfEmptyLine: false, AtFirstLineOfInputAndView: false, AtLastLineOfInputAndView: true
-- value:
"‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è©"

# Insert characters from the beginning, see the wrap adapt.
run observe=(view,pos,value)
key ctrl+a
type a
----
-- view:
[40m[37m‚îÉ [0m[0m[40m 1 [0m[40ma[0m[40m[7m‚è©[0m[0m[40m ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© [0m[40m [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40m‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© [0m[40m           [0m‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 0, Pos 1, (row 0, col 1, lastCharOffset 0)
LineInfo: {Width:23 CharWidth:34 Height:2 StartColumn:0 ColumnOffset:1 RowOffset:0 CharOffset:1}
AtBeginningOfEmptyLine: false, AtFirstLineOfInputAndView: true, AtLastLineOfInputAndView: false
-- value:
"a‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è©"

run observe=(view,pos,value)
key ctrl+a
type a
----
-- view:
[40m[37m‚îÉ [0m[0m[40m 1 [0m[40ma[0m[40m[7ma[0m[0m[40m‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© [0m[40m[0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40m‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© [0m[40m           [0m‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 0, Pos 1, (row 0, col 1, lastCharOffset 0)
LineInfo: {Width:24 CharWidth:35 Height:2 StartColumn:0 ColumnOffset:1 RowOffset:0 CharOffset:1}
AtBeginningOfEmptyLine: false, AtFirstLineOfInputAndView: true, AtLastLineOfInputAndView: false
-- value:
"aa‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è©"

run observe=(view,pos,value)
key ctrl+a
type a
----
-- view:
[40m[37m‚îÉ [0m[0m[40m 1 [0m[40ma[0m[40m[7ma[0m[0m[40ma‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© [0m[40m  [0m‚ê§
[40m[37m‚îÉ [0m[0m[37m[40m   [0m[0m[40m‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© [0m[40m        [0m‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   ‚ê§
[37m‚îÉ [0m[30m ~ [0m                                   üõá
-- pos:
Line: 0, Pos 1, (row 0, col 1, lastCharOffset 0)
LineInfo: {Width:23 CharWidth:33 Height:2 StartColumn:0 ColumnOffset:1 RowOffset:0 CharOffset:1}
AtBeginningOfEmptyLine: false, AtFirstLineOfInputAndView: true, AtLastLineOfInputAndView: false
-- value:
"aaa‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è© ‚è©"
